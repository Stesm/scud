function scud(n){"use strict";var o=this;o.patterns={};o.params={load_path:n?(n['load_path']?n['load_path']:'/tpls/'):'/tpls/'};o.process_patern=function(b,c,d){if(typeof b=='object'&&typeof c=='string'){s(c,function(a){o.process_str(b,a,d)})}else if(d)d('')};o.process_str=function(k,l,m){p(l,function(d){for(var e in k){if(k.hasOwnProperty(e)){var f=new RegExp('{'+e+'}','g');d=d.replace(f,k[e])}}var g=/\{EACH:([a-z0-9_]+:[a-z0-9_]+)}/ig,each=[],ea;while(ea=g.exec(d))each.push(ea);if(each.length){var h=[];for(var i=0;i<each.length;i++){var j=each[i][1].split(':');q(k[j[0]],j[1],each[i][0],i,function(a,b,c){d=d.replace(b,a);h.push(c);if(h.length==each.length){d=d.replace(/\{[a-z0-9_-]+}/ig,'');m(d)}})}}else{if(m){d=d.replace(/\{[a-z0-9_-]+}/ig,'');m(d)}}})};var p=function(c,d){var e=/\{INC:([a-z0-9_-]+)}/ig,t=[],r=[],_tmp=null;if(t=c.match(e)){while(_tmp=e.exec(c)){s(_tmp[1],function(a,b){c=c.replace(b[0],a);r.push(b[1]);if(r.length==t.length&&typeof d=='function')d(c)},_tmp)}}else if(typeof d=='function')d(c)};var q=function(f,g,h,j,k){if(f&&f.length){s(g,function(a){var b='';for(var i=0;i<=f.length;i++){var c=a;if(i==f.length){k(b,h,j);break}for(var d in f[i]){if(f[i].hasOwnProperty(d)){if(f[i][d]==null)f[i][d]='';var e=new RegExp('{'+d+'}','g');c=c.replace(e,f[i][d])}}b+=c}})}else if(k)k('',h,0)};var s=function(b,c,d){if(o.patterns[b]&&o.patterns[b].length>0){if(typeof c=='function')c(o.patterns[b],d)}else{$.ajax({type:"GET",url:o.params.load_path+b+'.tpl?'+Math.random(),success:function(a){o.patterns[b]=a;if(c)c(o.patterns[b],d)},async:false})}};var u=function(){if(n&&n.hasOwnProperty('patterns')&&n['patterns']instanceof Array&&n['patterns'].length){var r=[];for(var i=0;i<=n['patterns'].length;i++)if(typeof n['patterns'][i]=='string')s(n['patterns'][i],function(a,b){r.push(b);if(r.length==n['patterns'].length)return o},i)}else return o};return u()}
